library(tidyverse)
library(ggplot2)
library(ggpubr) 



##### Grafico homologas a gallina ####
#agrupo
chicken = group_by(Resultados, ChickenHomologue, Strain) %>% summarise("Amount of Proteins"=n()) 

#Reemplazo por los valores de AgProtect para todas las sp
chicken <- chicken %>%
  mutate(`Amount of Proteins` = case_when(
    `Amount of Proteins` == 363 ~ 377,
    `Amount of Proteins` == 1614 ~ 1600,
    TRUE ~ `Amount of Proteins`  # Keep the original value if no condition matches
  ))

#Agrego el total de cada grupo
chicken = full_join(chicken, Grupo, by="Strain")


#agrego columna porcentaje
chicken$Porcentaje_chicken = chicken$"Amount of Proteins" *100 / chicken$CantidadTotal

#calculo porcentaje de homologas
del <- chicken %>% 
  filter(ChickenHomologue == "Non Host Homologue",
         Strain != "Experimental Antigens") 

media <- round(mean(del$Porcentaje_chicken), digits = 2)

#Grafico 2 (con porcentajes)
p1 <- ggplot(chicken, aes(fill=ChickenHomologue, y=Porcentaje_chicken, x=Strain)) + 
  geom_bar(position="stack", stat="identity", show.legend = FALSE) + 
  scale_fill_manual(values =c("#9e2f28","olivedrab")) +
  #  #scale_fill_viridis(discrete=T, begin= 0.3, end = 0.65) +
  theme(axis.title = element_text(family = "Times New Roman", size=18, color = "black"), 
        title = element_text(family = "Times New Roman", size=16, color = "black"), 
        text = element_text(family = "Times New Roman", size = 16, color = "black"),
        axis.text = element_text(family = "Times New Roman", size = 16, color = "black"),
        panel.background =  element_rect(fill = "white"), 
        panel.grid.major = element_line(colour = "grey", linetype = "dotted", 
                                        linewidth = 0.3)) +
  coord_flip() + 
  labs(y = "Percentage of proteins") +
  geom_hline(yintercept = media, color = "blue")

#guardo
ggsave("chickenHomology2.png", device = "png", path = "~/Desktop/Graficos", 
       width =3500, height = 2300, units="px")



chicken_COG = group_by(Resultados, ChickenHomologue, Strain, COG_category_u) %>%
  summarise("Amount of Proteins"=n()) 

#Agrego el total de cada grupo
chicken_COG = full_join(chicken_COG, COG, by=c("Strain", "COG_category_u"))

#agrego columna porcentaje
chicken_COG$Porcentaje_chicken = chicken_COG$"Amount of Proteins" *100 / chicken_COG$CantidadTotal

chicken_COG <- chicken_COG %>% filter(substr(Strain, 1, 3) != "Exp")


means_Chicken <- chicken_COG %>%
  group_by(COG_category_u,ChickenHomologue) %>%
  summarize(mean_value = mean(Porcentaje_chicken))

p2 <- ggplot(means_Chicken, aes(fill=ChickenHomologue, y=mean_value, x=COG_category_u)) + 
  geom_bar(position="stack", stat="identity") + 
  scale_fill_manual(values =c("#9e2f28","olivedrab")) +
  #scale_fill_viridis(discrete=T, begin = 0.3, end=0.65)  +
  theme(axis.title = element_text(family = "Times New Roman"), 
        axis.text = element_text(family = "Times New Roman", size = 16, color = "black"),
        title = element_text(family = "Times New Roman"), 
        legend.title=element_blank(),
        legend.position="bottom",
        text = element_text(family = "Times New Roman", size = 18), 
        panel.background =  element_rect(fill = "white"), 
        panel.grid.major = element_line(colour = "grey", linetype = "dotted", 
                                        linewidth = 0.3)) + 
  labs(y = "Mean for all strains", 
       x = "COG category")

ggsave("chickenHomology.png", device = "png", path = "~/Desktop/Graficos", 
       width =3500, height = 2300, units="px")


ggarrange(p1, p2, 
          labels = c("2A", "2B"),
          ncol = 2, nrow = 1)

ggsave("2A&B.png", device = "png", path = "~/Desktop/Graficos", 
       width =3800, height = 3000, units="px")
